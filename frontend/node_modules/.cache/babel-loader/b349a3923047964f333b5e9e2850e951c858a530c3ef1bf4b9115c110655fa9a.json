{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from\"react\";import axios from\"axios\";import{AuthContext}from\"./AuthContext\";import{jsx as _jsx}from\"react/jsx-runtime\";export const CarContext=/*#__PURE__*/createContext();export const CarContextProvider=_ref=>{let{children}=_ref;const[cars,setCars]=useState([]);const[bookings,setBookings]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(false);// Petri Net states\nconst[carState,setCarState]=useState(\"P1\");const[bookingState,setBookingState]=useState(\"B1\");const[paymentState,setPaymentState]=useState(\"PY1\");const{userId}=useContext(AuthContext);const fetchCars=async()=>{setLoading(true);setCarState(\"P2\");try{const response=await axios.get(\"/api/cars/all\");setCars(response.data);setCarState(\"P3\");}catch(err){setError(\"Failed to fetch cars\");setCarState(\"P4\");}finally{setLoading(false);}};const addCar=async carData=>{setLoading(true);try{const response=await axios.post(\"/api/cars/add\",carData);setCars(prev=>[...prev,response.data]);setCarState(\"P3\");return true;}catch(err){setError(\"Failed to add car\");setCarState(\"P4\");return false;}finally{setLoading(false);}};const deleteCar=async carId=>{setLoading(true);try{await axios.delete(`/api/cars/${carId}`);setCars(prev=>prev.filter(car=>car._id!==carId));setCarState(\"P3\");}catch(err){setError(\"Failed to delete car\");}finally{setLoading(false);}};const bookCar=async carId=>{setLoading(true);setBookingState(\"B2\");try{if(!userId)throw new Error(\"User not authenticated\");const car=await axios.get(`/api/cars/${carId}`);if(!car.data||!car.data.isAvailable){throw new Error(car.data?\"Car not available\":\"Car not found\");}const bookingResponse=await axios.post(\"/api/bookings/book\",{user:userId,car:carId});setCars(prev=>prev.map(c=>c._id===carId?{...c,isAvailable:false}:c));setBookings(prev=>[...prev,bookingResponse.data.booking]);setBookingState(\"B4\");setPaymentState(\"PY2\");return{bookingId:bookingResponse.data.booking._id,amount:car.data.price};}catch(err){setError(err.message);setBookingState(\"B3\");setPaymentState(\"PY4\");return null;}finally{setLoading(false);}};const processPayment=async(bookingId,amount)=>{setPaymentState(\"PY2\");try{const paymentResponse=await axios.post(\"/api/payments/create-payment-intent\",{bookingId,amount});return paymentResponse.data.clientSecret;}catch(err){setError(\"Payment initialization failed\");setPaymentState(\"PY4\");return null;}};const confirmPayment=async paymentIntentId=>{try{await axios.post(\"/api/payments/confirm-payment\",{paymentIntentId});setPaymentState(\"PY3\");setBookingState(\"B5\");return true;}catch(err){setError(\"Payment confirmation failed\");setPaymentState(\"PY4\");return false;}};const cancelBooking=async bookingId=>{setLoading(true);try{const response=await axios.delete(`/api/bookings/${bookingId}`);setCars(prev=>prev.map(car=>car._id===response.data.car._id?{...car,isAvailable:true}:car));setBookings(prev=>prev.filter(b=>b._id!==bookingId));return true;}catch(err){setError(\"Failed to cancel booking\");return false;}finally{setLoading(false);}};const fetchBookings=async()=>{setLoading(true);try{const response=await axios.get(\"/api/bookings\");setBookings(response.data);}catch(err){setError(\"Failed to fetch bookings\");}finally{setLoading(false);}};useEffect(()=>{fetchCars();fetchBookings();},[]);return/*#__PURE__*/_jsx(CarContext.Provider,{value:{cars,bookings,error,loading,carState,bookingState,paymentState,setBookingState,// ✅ ADDED HERE\nsetPaymentState,fetchCars,addCar,deleteCar,bookCar,processPayment,confirmPayment,cancelBooking,fetchBookings},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","axios","AuthContext","jsx","_jsx","CarContext","CarContextProvider","_ref","children","cars","setCars","bookings","setBookings","error","setError","loading","setLoading","carState","setCarState","bookingState","setBookingState","paymentState","setPaymentState","userId","fetchCars","response","get","data","err","addCar","carData","post","prev","deleteCar","carId","delete","filter","car","_id","bookCar","Error","isAvailable","bookingResponse","user","map","c","booking","bookingId","amount","price","message","processPayment","paymentResponse","clientSecret","confirmPayment","paymentIntentId","cancelBooking","b","fetchBookings","Provider","value"],"sources":["D:/DevOps Practice/Car-Rental-Application/frontend/src/context/CarContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { AuthContext } from \"./AuthContext\";\r\n\r\nexport const CarContext = createContext();\r\n\r\nexport const CarContextProvider = ({ children }) => {\r\n  const [cars, setCars] = useState([]);\r\n  const [bookings, setBookings] = useState([]);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Petri Net states\r\n  const [carState, setCarState] = useState(\"P1\");\r\n  const [bookingState, setBookingState] = useState(\"B1\");\r\n  const [paymentState, setPaymentState] = useState(\"PY1\");\r\n\r\n  const { userId } = useContext(AuthContext);\r\n\r\n  const fetchCars = async () => {\r\n    setLoading(true);\r\n    setCarState(\"P2\");\r\n    try {\r\n      const response = await axios.get(\"/api/cars/all\");\r\n      setCars(response.data);\r\n      setCarState(\"P3\");\r\n    } catch (err) {\r\n      setError(\"Failed to fetch cars\");\r\n      setCarState(\"P4\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addCar = async (carData) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await axios.post(\"/api/cars/add\", carData);\r\n      setCars(prev => [...prev, response.data]);\r\n      setCarState(\"P3\");\r\n      return true;\r\n    } catch (err) {\r\n      setError(\"Failed to add car\");\r\n      setCarState(\"P4\");\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteCar = async (carId) => {\r\n    setLoading(true);\r\n    try {\r\n      await axios.delete(`/api/cars/${carId}`);\r\n      setCars(prev => prev.filter(car => car._id !== carId));\r\n      setCarState(\"P3\");\r\n    } catch (err) {\r\n      setError(\"Failed to delete car\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const bookCar = async (carId) => {\r\n    setLoading(true);\r\n    setBookingState(\"B2\");\r\n    try {\r\n      if (!userId) throw new Error(\"User not authenticated\");\r\n\r\n      const car = await axios.get(`/api/cars/${carId}`);\r\n      if (!car.data || !car.data.isAvailable) {\r\n        throw new Error(car.data ? \"Car not available\" : \"Car not found\");\r\n      }\r\n\r\n      const bookingResponse = await axios.post(\"/api/bookings/book\", {\r\n        user: userId,\r\n        car: carId,\r\n      });\r\n\r\n      setCars(prev => prev.map(c => c._id === carId ? { ...c, isAvailable: false } : c));\r\n      setBookings(prev => [...prev, bookingResponse.data.booking]);\r\n\r\n      setBookingState(\"B4\");\r\n      setPaymentState(\"PY2\");\r\n\r\n      return {\r\n        bookingId: bookingResponse.data.booking._id,\r\n        amount: car.data.price\r\n      };\r\n    } catch (err) {\r\n      setError(err.message);\r\n      setBookingState(\"B3\");\r\n      setPaymentState(\"PY4\");\r\n      return null;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const processPayment = async (bookingId, amount) => {\r\n    setPaymentState(\"PY2\");\r\n    try {\r\n      const paymentResponse = await axios.post(\r\n        \"/api/payments/create-payment-intent\",\r\n        { bookingId, amount }\r\n      );\r\n      return paymentResponse.data.clientSecret;\r\n    } catch (err) {\r\n      setError(\"Payment initialization failed\");\r\n      setPaymentState(\"PY4\");\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const confirmPayment = async (paymentIntentId) => {\r\n    try {\r\n      await axios.post(\"/api/payments/confirm-payment\", {\r\n        paymentIntentId\r\n      });\r\n      setPaymentState(\"PY3\");\r\n      setBookingState(\"B5\");\r\n      return true;\r\n    } catch (err) {\r\n      setError(\"Payment confirmation failed\");\r\n      setPaymentState(\"PY4\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const cancelBooking = async (bookingId) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await axios.delete(`/api/bookings/${bookingId}`);\r\n\r\n      setCars(prev =>\r\n        prev.map(car =>\r\n          car._id === response.data.car._id ? { ...car, isAvailable: true } : car\r\n        )\r\n      );\r\n\r\n      setBookings(prev => prev.filter(b => b._id !== bookingId));\r\n      return true;\r\n    } catch (err) {\r\n      setError(\"Failed to cancel booking\");\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchBookings = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await axios.get(\"/api/bookings\");\r\n      setBookings(response.data);\r\n    } catch (err) {\r\n      setError(\"Failed to fetch bookings\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCars();\r\n    fetchBookings();\r\n  }, []);\r\n\r\n  return (\r\n    <CarContext.Provider value={{\r\n      cars,\r\n      bookings,\r\n      error,\r\n      loading,\r\n      carState,\r\n      bookingState,\r\n      paymentState,\r\n      setBookingState,      // ✅ ADDED HERE\r\n      setPaymentState,\r\n      fetchCars,\r\n      addCar,\r\n      deleteCar,\r\n      bookCar,\r\n      processPayment,\r\n      confirmPayment,\r\n      cancelBooking,\r\n      fetchBookings\r\n    }}>\r\n      {children}\r\n    </CarContext.Provider>\r\n  );\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}